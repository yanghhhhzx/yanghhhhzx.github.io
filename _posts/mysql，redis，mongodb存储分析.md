# mysql，redis，mongodb存储分析
- 引言：本篇**只分析三种在存储、存储过程上的差异。不包括数据类型和语法等基础层面的解析，也不包括Nosql和关系型数据库的对比，也不会解释专有名词**。重点是Mysql和Redis，将以下面的方式进行展开：
1. 逐个分析
2. 对比分析

# 逐个分析
## Mysql
在mysql中，不同的存储引擎会具有不同的特性，包括存储的过程、存储的方式等等。所以我对我所认识到的两个常用的引擎做分析:
### InnoDB
- 存储数据时的过程：
1. 先将数据写入内存缓存区Buffer Pool（读取时也会先找Buffer Pool）
2. 写入日志
3. **异步**写入磁盘
- 存储方式和索引 ：使用B+树，Innodb会自动创建聚簇索引，**数据文件本身就是聚簇索引文件**，所以**聚簇索引查找不需要回表**，只有非聚簇索引（二级索引）才需要回表，其存的是主键值。Innodb要求**必须有主键**。（联合索引一定是二级索引）
- **支持事务**，有**4种事务隔离级别**，默认是使用**RR**（可重复读），在RR时采用的是**MVCC**机制，不加锁，操作数据时先操作快照，可以进行回滚。
- 锁：当采用更高的事务隔离级别时，会加锁，**支持行锁、表锁、库锁**。

### MyISAM
- 存储的过程：直接写入磁盘，没有内存。会写日志，但没有事务日志。
- 存储方式和索引 ：使用B+树，没有**聚簇索引，只有二级索引**，索引文件和数据文件是分离的，在索引上存的是数据地址。所以**任何的查询都要回表**（但是他的回表是非常迅速的，因为是直接基于地址偏移量，而**Innodb的回表是根据主键，所以等于还得查一次**）。可以没有主键。
- 不支持事务。
- 只有表级锁，写操作会加锁。

## MongoDB
我对Mongodb两个常用引擎进行分析，但相对于mysql内容可能更少。WiredTiger是MongoDB 3.0版本后引入的默认存储引擎，‌而MMAPv1是MongoDB 3.0版本之前的默认存储引擎。
- 存储数据时的过程：
1. 也是先写入内存缓冲区
2. 异步写入磁盘
3. 日志。
- 索引：官方文档说WiredTiger是使用B-Tree，部分博客说是B+树
- 数据读取：都会采用内存映射文件的方式管理数据，‌将常用的数据加载到内存中。‌
其他：
 - WiredTiger支持事务、写性能更好
 - MMAPv1不支持事务操作、读性能较好

## Redis
数据直接存在内存，需要依赖持久化策略才会将数据记录到磁盘。但是Redis**磁盘中的数据是无法在使用过程中直接查询到的**，它指挥读取内存中的内容，**它记录到磁盘，只是为了防止宕机导致数据大量丢失**。它会在**启动时，自动将磁盘中数据写入copy到内存**，如果内存空间不足，那么就会有部分在磁盘中的数据是同步不到内存的，这些数据也是在运行时查不到的。

- 持久化的两种方式：**RDB和AOF**（网上很多这两者的对比）
- 当内存不足时，包括启动时和运行时，都会触发**内存淘汰策略**。

其他Redis特性可以看我另外一篇文章，里面也会有更详细的说明。

# 对比分析
1. mysql和mongodb都是自动持久化的，只要有数据，会先写内存再异步写磁盘（MyISAM直接写磁盘）。而redis可以执行配置持久化策略决定是否需要持久化。
2. Redis不能直接读写读磁盘中的文件，它的磁盘只能当做一个备份机制，而mysql和mongodb在内存中找不到数据，会查磁盘。（他们主要是查磁盘，而内存主要是为了加快速度）。


_**版权声明：本文为博主原创文章，转载请附上原文出处链接和本声明。**_

